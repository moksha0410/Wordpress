import{writable,readable,derived,get}from"svelte/store";export const questions=writable({});class Store{questions;viewableQuestions=[];currentPage;itemsPerPage=5;searchText;numOfTotalPages;constructor(){this.searchText=writable(""),this.currentPage=writable(0),this.questions=writable([]),this.viewableQuestions=this.getviewableQuestions(),this.numOfTotalPages=derived(this.questions,(e=>Math.ceil(e.length/this.itemsPerPage)))}updateCurrentPage(e){this.currentPage.set(e)}getviewableQuestionsTest(){return derived(this.questions,(e=>e.slice(0,2)))}setSearchText(e){this.searchText.set(e)}onPaginationChange(e){let t,s=get(this.currentPage),a=get(this.numOfTotalPages);switch(e){case"previous":t=s-1;break;case"next":t=s+1;break;case"first":t=0;break;case"last":t=a-1;break;default:t=e.split("-")[1],t=parseInt(t)}0>t||t>a-1||this.updateCurrentPage(t)}getviewableQuestions(){let e=this;return derived([this.questions,this.searchText,this.currentPage],(([t,s,a])=>t.filter((function(t){if(""==s)return!0;return e.checkMatch(t,s)})).slice(a*e.itemsPerPage,(a+1)*e.itemsPerPage)))}setQuestions(e){this.questions.set(e)}postVote(e){jQuery.post(helpie_faq_object.ajax_url,e,(function(e){JSON.parse(e)}))}async postItem(e){let t,s=e;return s.action="helpie_qna_submission",t=await jQuery.post(helpie_faq_object.ajax_url,s),await this.getPosts(e),t}checkMatch(e,t){let s=!1;if(s=e.content.toLowerCase().includes(t.toLowerCase()),s)return s;for(var a=0;a<e.answers.length&&(s=e.answers[a].content.toLowerCase().includes(t.toLowerCase()),!s);++a);return s}async getPosts(e){let t=[],s=e;return s.action="helpie_qna_get_posts",await jQuery.get(helpie_faq_object.ajax_url,s,(function(e){JSON.parse(e).forEach((e=>{let s={content:e.post_title,id:e.ID,answers:[],votes:e.votes,url:e.guid,currentUserVotes:e.current_user_votes,userHasAlreadyAnswered:e.user_has_already_answered};e.answers.forEach((e=>{s.answers.push({content:e.comment_content,answer_by:e.comment_author,created_date:e.comment_date,comment_ID:e.comment_ID,votes:e.votes,human_time_diff:e.human_time_diff})})),t[t.length]=s}))})),this.setQuestions(t),t}}export default Store;