var Tracker=require("../../../assets/js/components/insights/tracker"),ObjectSearch=require("../../../assets/js/components/faq/object_search.js"),FaqFunctions=require("../../../assets/js/components/faq/functions.js"),FaqCollections=require("../../../assets/js/components/faq/collections.js"),Pagination=require("../../../assets/js/components/faq/pagination.js"),selectors={accordions:".helpie-faq.accordions",faqSearch:".helpie-faq .search__wrapper .search__input",accordion:".accordion",accordionShow:"accordion--show",accordionHide:"accordion--hide",accordionHeading:".accordion__heading",accordionHeadingShow:"accordion__heading--show",accordionHeadingHide:"accordion__heading--hide",accordionHeader:".accordion .accordion__item .accordion__header",accordionItem:".accordion__item",accordionItemShow:"accordion__item--show",accordionItemHide:"accordion__item--hide",accordionBody:".accordion__body",searchMessage:".search .search__message",searchMessageContent:"<p class='search__message__content'>"+faqStrings.noFaqsFound+"</p>"},Stylus={searchTerm:"",typingTimer:0,doneTypingInterval:2e3,paginationEnabled:"0",setSearchAttr:function(){jQuery(selectors.accordionHeader).each((function(){var e=jQuery(this).text().toLowerCase();jQuery(this).attr("data-search-term",e)}))},isContentMatch:function(e,o){return jQuery(e).find(selectors.accordionBody).text().toLowerCase().indexOf(o)>=0},isTitleMatch:function(e,o){var c=jQuery(e).find(".accordion__header").attr("data-search-term");return null!=c&&"undefined"!=c&&c.search(o)>=0},isCategoryHeadingMatch:function(e,o){return jQuery(e).prev(selectors.accordionHeading).text().toLowerCase().indexOf(o)>=0},isCategroryAccordionMatch:function(e,o){if(0==jQuery(e).hasClass("accordion__category"))return!1;return this.isTitleMatch(e,o)},searchByAccordionItem:function(e,o){let c=this;searchTerm=c.searchTerm;let s=c.isTitleMatch(e,searchTerm),r=c.isContentMatch(e,searchTerm),n=c.searchByTags(e,searchTerm);var t=!!(s||r||n);return c.displayAccordionItem(e,t),t},onSearchKeyup:function(e){var o=this;const c=o.searchTerm;jQuery(e).closest(selectors.accordions).children(selectors.accordion).each((function(){var e=jQuery(this),s=!1;1==o.isCategoryHeadingMatch(e,c)?(s=!0,o.showAccordionSection(e,s)):e.children(selectors.accordionItem).each((function(){$accordionItem=jQuery(this);var e=$accordionItem.hasClass("accordion__category");let r=o.searchByCategory($accordionItem,c),n=!(!e||!r),t=0==n,a=!1;t&&(a=o.searchInnerAccordionsItems($accordionItem,c));let i=0==e,d=!1;i&&(d=o.searchByAccordionItem($accordionItem,{})),e&&0==a&&o.showCategoryWithAccordions($accordionItem,n),t&&a&&o.showAccordionBelongsToCategory($accordionItem,!0),0==s&&(1==n&&(s=!0),1==t&&1==a&&(s=!0),1==i&&1==d&&(s=!0))})),o.displayHeading(e,s),o.showAccordion(e,s)}))},searchByCategory:function(e,o){return this.isCategroryAccordionMatch(e,o)},searchInnerAccordionsItems:function(e,o){let c=this,s=!1;return e.find(selectors.accordionItem).each((function(){$item=jQuery(this),1==c.searchByAccordionItem($item,{})&&(s=!0)})),s},init:function(){var e=this;e.setSearchAttr(),jQuery("body").on("keyup",selectors.faqSearch,(function(o){var c=jQuery(this).val().toLowerCase().replace(/[*+?^${}()|[\]\\]/gi,"");e.searchTerm=c;let s=FaqFunctions.getElements(this);return e.paginationEnabled=FaqFunctions.paginationEnabled(this),e.canSeeEmptyFAQsBlock(this,"hide"),""==e.searchTerm&&"1"==e.paginationEnabled?(jQuery(s.root).attr("data-search","0"),e.showAllAccordionsFromObject(this),!1):""==e.searchTerm&&"1"!=e.paginationEnabled?(e.showAllAccordions(this),!1):("1"==e.paginationEnabled?(jQuery(s.root).attr("data-search","1"),ObjectSearch.init(this,c)):e.onSearchKeyup(this),e.showEmptyFAQsContent(this),""!=e.searchTerm&&(clearTimeout(e.typingTimer),void(e.typingTimer=setTimeout((function(){Tracker.searchCounter(e.searchTerm)}),e.doneTypingInterval))))}))},showAllAccordions:function(e){var o=this;jQuery(e).closest(selectors.accordions).children(selectors.accordion).each((function(){let e=jQuery(this);o.showAccordion(e,true),o.displayHeading(e,true),e.find(selectors.accordion).removeClass(selectors.accordionHide).addClass(selectors.accordionShow),e.find(selectors.accordionItem).removeClass(selectors.accordionItemHide).addClass(selectors.accordionItemShow)}))},showEmptyFAQsContent:function(e){var o=this,c=0,s=jQuery(e).closest(selectors.accordions).find(selectors.accordionItem).length;jQuery(e).closest(selectors.accordions).find(selectors.accordionItem).each((function(){0==jQuery(this).is(":visible")&&(c=parseInt(c)+1)})),c==s&&(jQuery(e).closest(selectors.accordions).find(selectors.accordion).each((function(){let e=jQuery(this);o.displayHeading(e,!1),o.showAccordion(e,!1)})),jQuery(e).closest(selectors.accordions).find(selectors.searchMessage).empty().show().append(selectors.searchMessageContent))},canSeeEmptyFAQsBlock:function(e,o){var c="none";"show"==o&&(c="block"),jQuery(e).closest(selectors.accordions).find(selectors.searchMessage).css("display",c)},displayAccordionItem:function(e,o){const c=1==o?selectors.accordionItemShow:selectors.accordionItemHide,s=0==o?selectors.accordionItemShow:selectors.accordionItemHide;e.removeClass(s).addClass(c)},displayHeading:function(e,o){const c=1==o?selectors.accordionHeadingShow:selectors.accordionHeadingHide,s=0==o?selectors.accordionHeadingShow:selectors.accordionHeadingHide;e.prev(selectors.accordionHeading).removeClass(s).addClass(c)},showCategoryAccordions:function(e,o){const c=1==o?selectors.accordionItemShow:selectors.accordionItemHide,s=0==o?selectors.accordionItemShow:selectors.accordionItemHide;jQuery(e).find(selectors.accordionItem).removeClass(s).addClass(c)},showAccordionSection:function(e,o){var c=this;c.displayHeading(e,o),c.showCategoryAccordions(e,o),c.showAccordion(e,o)},showAccordion:function(e,o){const c=1==o?selectors.accordionShow:selectors.accordionHide,s=0==o?selectors.accordionShow:selectors.accordionHide;jQuery(e).removeClass(s).addClass(c)},showCategoryWithAccordions:function(e,o){var c=this;c.displayAccordionItem(e,o),c.showCategoryAccordions(e,o),c.showAccordion(e,o)},showAccordionBelongsToCategory:function(e,o){jQuery(e).find(selectors.accordion).removeClass(selectors.accordionHide).addClass(selectors.accordionShow),this.displayAccordionItem(e,o)},searchByTags:function(e,o){let c=jQuery(e).find(".accordion__header").attr("data-tags"),s=!1;return null==c||"undefined"==c||0==c.length||c.split(",").forEach((function(e){-1!=(e=e.toLowerCase()).search(o)&&(s=!0)})),s},showAllAccordionsFromObject:function(e){let o=FaqFunctions.getElements(e),c=FaqFunctions.getPaginationCurrentPage(o),s=FaqFunctions.getShortcodeIndex(o),r={page:c},n=FaqCollections.getCurrentShortcodeViewProps(s),t=FaqCollections.getTotalNoOfPages(n),a=FaqCollections.getCurrentPageViewProps(r,{collection:n.collection,items:n.items});FaqFunctions.appendFaqsContent(o,a),Pagination.renderPageLinks(o.pagination,{current:c,last:t})}};module.exports=Stylus;